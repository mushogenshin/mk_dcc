import maya.mel as mel
import pymel.core as pm

root_jnt = pm.ls("C_world", type="joint", r=True)

if root_jnt:

    root_jnt = root_jnt[0]
    male = root_jnt.male.get()

    if male:
        print("Working on MALE rig...")

        # meshes = ("Body_mesh", "Comb_mesh")
        #
        # # combines the comb mesh
        # # finds the namespace
        # ns = root_jnt.name().rpartition(":")[0]
        #
        # cmds.select(cl=True)
        # for m in meshes:
        #     cmds.select(":".join([ns, m]), add=True)
        #
        # new_mesh, new_skinCluster = cmds.polyUniteSkinned(ch=False)
        #
        # cmds.rename(new_mesh, meshes[0])
        # cmds.rename(new_skinCluster, "Body_skinCluster")
        #
        # engine_grp = cmds.ls("engine_GRP", r=True)
        #
        # if engine_grp:
        #     mesh_grp = cmds.group(em=True, n="SKAndean_Condor")
        #     cmds.parent(mesh_grp, engine_grp[0])
        #     cmds.parent(meshes[0], mesh_grp)

    else:
        print("Working on FEMALE rig...")

        # deletes the comb mesh
        comb_mesh_faces_collection = '.f[21639:21984]'

        body_mesh = cmds.ls("Body_mesh", r=True)

        if body_mesh:
            comb_mesh = body_mesh[0] + comb_mesh_faces_collection
            cmds.select(comb_mesh, r=True)
            cmds.delete(ch=False)
            cmds.refresh(cv=True)

        # now deletes the non-deformer histoty
        cmds.select(body_mesh, r=True)
        mel.eval('doBakeNonDefHistory( 1, {"prePost"})')  # this evaluation takes a long time!!!

        # deletes the MaleFeatureSet
        MaleFeatureSet = cmds.ls("MaleFeatureSet", r=True)

        if MaleFeatureSet:
            cmds.select(MaleFeatureSet, r=True)
            # cmds.select(hi=True)
            cmds.delete()
